- defaultTab: output
  description: Add Workload Domain to Existing Management Domain using a YAML file
  executionEnabled: true
  id: 27e0f720-ec28-4455-a2ab-16edebd2c743
  loglevel: INFO
  multipleExecutions: true
  name: Add Workload Domain to Existing Management Domain - YAML
  nodeFilterEditable: false
  options:
  - description: "    Example: lab1, lab2, pod3, pod4\n    \n    Ensure the number\
      \ is always unique, no special characters are allowed, only letters and numbers."
    label: Lab Name
    name: lab_name
    required: true
  - delimiter: ','
    description: Optional playbook ansible tags to run certain tasks only from the
      playbook.
    label: Playbook Tags
    multivalued: true
    name: playbook_tags
    value: all
  - description: "    ######################################################################################################\n\
      \    ######### Following Lab will be deployed with manaul specified IPs for\
      \ Management Domain\n    ######### and auto generated IPs for Workload Domain,\
      \ ensure to remove \"_example\" from filename\n    ######################################################################################################\n\
      \    ######################################################################################################\n\
      \    ######### COMMON CONFIG ##############################################################################\n\
      \    ######################################################################################################\n\
      \    dns_server_2: 192.168.0.1\n    time_zone: GMT Standard Time\n    time_server_1:\
      \ 0.uk.pool.ntp.org\n    time_server_2: 1.uk.pool.ntp.org\n    pods_network_16:\
      \ 10.2.0.0/16 ### Will be used to calculate the networks for management and\
      \ workload\n    pods_password: VMware1!VMware1!\n    pods_domain_name: harrythambi.cloud\
      \ ### domain to be created within management domain\n    pods_mtu: 9000\n\n\
      \    ######################################################################################################\n\
      \    #### MANAGEMENT DOMAIN CONFIG ########################################################################\n\
      \    ######################################################################################################\n\
      \    management_pod_name: mp                     ### default \"mp\"\n    management_pod_generate_inventory:\
      \ false     ### true or false\n    management_pod_generate_networks: false \
      \     ### true or false\n    management_pod_target_datastore: esx01_ssd02\n\n\
      \    management_pod_esxi_server_hostname: mp-esxi01.harrythambi.cloud\n    management_pod_esxi_server_ip:\
      \ 10.20.0.4\n    management_pod_esxi_server_username: root\n    management_pod_esxi_server_password:\
      \ VMware1!VMware1!\n\n    management_pod_winadmin_server_hostname: mp-winadm01.harrythambi.cloud\n\
      \    management_pod_winadmin_server_ip: 10.20.0.10\n    management_pod_winadmin_server_username:\
      \ Administrator\n    management_pod_winadmin_server_password: VMware1!VMware1!\n\
      \n    management_pod_vcenter_server_hostname: mp-vcsa01.harrythambi.cloud\n\
      \    management_pod_vcenter_server_ip: 10.20.0.14\n    management_pod_vcenter_server_username:\
      \ Administrator@vsphere.local\n    management_pod_vcenter_server_password: VMware1!VMware1!\n\
      \n    management_pod_vcenter_datacenter_name: mp\n    management_pod_vcenter_cluster_name:\
      \ mp_mgmt_cluster\n    management_pod_vcenter_vds_name: vds_mp\n\n    ## If\
      \ management_pod_generate_networks is false\n    ##################################################\n\
      \    # management_pod_mgmt_network: 10.1.0.1/24        ### vlan 10\n    # management_pod_storage_network:\
      \ 10.1.1.1/24     ### vlan 11\n    # management_pod_routers_network: 10.1.2.1/24\
      \     ### vlan 12\n\n    ######################################################################################################\n\
      \    #### WORKLOAD DOMAIN CONFIG ##########################################################################\n\
      \    ######################################################################################################\n\
      \    workload_pod_name_prefix: lab                            ### Will be combined\
      \ with number to give overall pod name eg. \"lab\" and \"1\" = \"lab1\"\n  \
      \  workload_pod_number: 2                                 ### Will be combined\
      \ with number to give overall pod name eg. \"lab\" and \"1\" = \"lab1\"\n  \
      \  workload_pod_generate_networks: true          ### true or false\n    workload_pod_target_datastore:\
      \ esx01_ssd02\n\n    physical_core_bgp_asn: 100                            \
      \   ### Required of BGP is possible on phsyical network\n    # workload_pod_tor_bgp_asn:\
      \ 101                              ### Default = physical_core_bgp_asn + pod\
      \ number\n    # workload_pod_nsxt_bgp_asn: 1010                            \
      \  ### Default = physical_core_bgp_asn + pod number * 10\n\n    workload_pod_vyos_router_number_of:\
      \ 2\n    workload_pod_vyos_router_name_prefix: vyos\n    # if management_pod_generate_inventory\
      \ is false\n    workload_pod_vyos_router_mgmt_portgroup_name: mp_mgmt\n    workload_pod_vyos_router_mgmt_portgroup_network_cidr:\
      \ 10.20.0.1/24\n    workload_pod_vyos_router_mgmt_portgroup_vip: 10.20.0.20\n\
      \    workload_pod_vyos_router_1_mgmt_portgroup_ip1: 10.20.0.21\n    workload_pod_vyos_router_2_mgmt_portgroup_ip2:\
      \ 10.20.0.22\n    # workload_pod_vyos_router_nth_ip: # The number is worked\
      \ out based on the pod number * 3 example: (1*3 , 2*3, 3*3)\n\n    workload_pod_esxi_server_number_of:\
      \ 3\n    workload_pod_esxi_server_name_prefix: esxi\n    workload_pod_esxi_server_nth_ip:\
      \ 4\n    workload_pod_esxi_server_target_datastore: esx01_ssd02\n    workload_pod_esxi_server_cpu:\
      \ 8\n    workload_pod_esxi_server_memory: 32\n\n    workload_pod_vcenter_server_number_of:\
      \ 1\n    workload_pod_vcenter_server_name_prefix: vcsa\n    workload_pod_vcenter_server_nth_ip:\
      \ 13\n    workload_pod_vcenter_server_deployment_size: tiny\n    workload_pod_vcenter_vsan_cache_disk_size:\
      \ 60\n    workload_pod_vcenter_vsan_capacity_disk_size: 600\n    workload_pod_vcenter_vsan_cache_disk_target_datastore:\
      \ esx01_nvme02\n    workload_pod_vcenter_vsan_capacity_disk_target_datastore:\
      \ esx01_ssd02\n\n    workload_pod_nsxt_manager_number_of: 1\n    workload_pod_nsxt_manager_name_prefix:\
      \ nsxtlmgr\n    workload_pod_nsxt_manager_nth_ip: 15\n    workload_pod_nsxt_manager_deployment_size:\
      \ small\n    workload_pod_nsxt_manager_vip: 23\n\n    workload_pod_nsxt_global_manager_number_of:\
      \ 1\n    workload_pod_nsxt_global_manager_name_prefix: nsxtlmgr\n    workload_pod_nsxt_global_manager_nth_ip:\
      \ 18\n    workload_pod_nsxt_global_manager_deployment_size: small\n    workload_pod_nsxt_global_manager_vip:\
      \ 24\n\n    workload_pod_nsxt_edge_number_of: 2\n    workload_pod_nsxt_edge_name_prefix:\
      \ nsxtedge\n    workload_pod_nsxt_egde_nth_ip: 21\n    workload_pod_nsxt_egde_deployment_size:\
      \ small\n\n    workload_pod_components:\n      vyos:\n        filename: vyos.ova\n\
      \      vcenter:\n        license: 04214-492E2-488G5-0K9R4-A46QM\n        filename:\
      \ VMware-vCenter-Server-Appliance-7.0.3.01200-20990077_OVF10.ova\n      centos:\n\
      \        filename: CentOS-7-minimal.iso\n      esxi:\n        license: 4H625-2TW92-488G8-0WVA2-DJP50\n\
      \        filename: Nested_ESXi7.0u3c_Appliance_Template_v1.ova\n      nsxt:\n\
      \        license: K109K-4N0DL-T8AD9-0TC0K-1XCLJ\n        filename: nsx-unified-appliance-4.0.1.1.0.20598732.ova\n\
      \      nsxv:\n        license: \n        filename: VMware-NSX-Manager-6.4.4-11197766.ova\n\
      \      avi:\n        license: \n        filename: controller-21.1.3-9051.ova\n\
      \      vcd:\n        license: \n        filename: VMware_Cloud_Director-10.3.1.6797-18738799_OVF10.ova\n\
      \n\n    # workload_pod_vlan_range: 10-29\n    # workload_pod_mgmt_network: 10.1.10.1/24\
      \                  ### vlan 110\n    # workload_pod_vmware_network: 10.1.11.1/24\
      \                ### vlan 111\n    # workload_pod_vmotion_network: 10.1.12.1/24\
      \               ### vlan 112\n    # workload_pod_storage_network: 10.1.13.1/24\
      \               ### vlan 113\n    # workload_pod_edge_overlay_tep_network: 10.1.14.1/24\
      \      ### vlan 114\n    # workload_pod_host_overlay_tep_network: 10.1.15.1/24\
      \      ### vlan 115\n    # workload_pod_edge_uplink_1_network: 10.1.16.1/24\
      \         ### vlan 116\n    # workload_pod_edge_uplink_2_network: 10.1.17.1/24\
      \         ### vlan 117\n    # workload_pod_overlay_rtep_network: 10.1.18.1/24\
      \          ### vlan 118\n    # workload_pod_vxlan_vtep_network: 10.1.19.1/24\
      \            ### vlan 119\n    # workload_pod_dmz_network: 10.1.20.1/24    \
      \               ### vlan 120\n\n    # 1*20-10\n    # 2*20-10\n    # 3*20-10\
      \ 3*20+9\n    # 4*70-89 \n    # 12*20-10 12*20+9\n    # 230-249\n\n"
    label: Lab JSON File
    name: lab_json
    required: true
    type: file
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: true
  sequence:
    commands:
    - description: Copy YAML file to Container
      exec: cp ${file.lab_json} /docker/files/${option.lab_name}_pod_inputs.yaml
    - description: Docker Run Ansible Playbook
      exec: docker run --privileged --rm -v /docker/files:/mnt/files harrythambi/homelab_builder_ansible:0.1
        python3 /opt/homelab_builder/run_playbook.py --pod-name ${option.lab_name}
        --pod-inputs-file /mnt/files/${option.lab_name}_pod_inputs.yaml --create-inventory
        --run-ansible --playbook /opt/homelab_builder/deploy_workload_pod_vsan.yaml
        --playbook-tags ${option.playbook_tags}
    keepgoing: false
    strategy: node-first
  uuid: 27e0f720-ec28-4455-a2ab-16edebd2c743
